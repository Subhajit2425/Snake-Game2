<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Snake Game 2</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />

  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      height: 100%;
      width: 100%;
      touch-action: none;
    }

    body {
      background-color: black;
      color: white;
      font-family: monospace;
      white-space: pre;
      overflow: hidden;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100vh;
      height: var(--app-height);
    }

    canvas {
      border: 2px solid white;
      background-color: black;
      display: block;
      margin: 0;
    }

    .overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      display: flex;
      flex-direction: column;
      align-items: center;
      color: white;
    }

    #mobileControls {
      margin-top: auto; /* ‚úÖ Pushes to bottom of game box */
      padding-bottom: 10px; /* ‚úÖ Some breathing room */
      display: none;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      max-height: 40vh; /* ‚úÖ Prevent overflow on small screens */
      overflow-y: auto; /* ‚úÖ Allow scroll if needed */
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 1001;
      left: 0;
      top: 0;
      width: 100vw;
      height: 100vh;
      overflow: auto;
      background-color: rgba(0,0,0,0.8);
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #1b1b1b, #333);
      padding: 20px 30px;
      border-radius: 15px;
      box-shadow: 0 0 15px #00ffe1;
      text-align: center;
      color: white;
      max-width: 600px;
      animation: fadeIn 0.5s ease-in-out;
    }

    .modal-content a {
      color: #00ffe1;
      text-decoration: underline;
    }

    .modal-content button {
      margin-top: 20px;
    }

    .mobileButtons {
      width: 70px;
      height: 70px;
      font-size: 1.8rem;
      font-weight: bold;
      border-radius: 50%;
      border: none;
      background: radial-gradient(circle at 30% 30%, #00ffe1, #003b95);
      color: #fff;
      box-shadow: 0 0 10px #00ffe1, 0 0 20px #00ffe1;
      transition: all 0.2s ease-in-out;
      cursor: pointer;
    }

    .mobileButtons:active {
      transform: scale(0.95);
      box-shadow: 0 0 5px #00ffe1, 0 0 10px #00ffe1;
    }

    .mobileRow {
      display: flex;
      gap: 15px;
    }

    .menuButtons, .overButtons {
      display: flex;
      justify-content: center;
      flex-direction: column;
      align-items: center;
      gap: 20px;
      margin-top: 20px;
    }

    #controls {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 4px;
    }

    #SnakeM, #OverHeader, .About {
      font-size: 2.5rem;
      letter-spacing: 2px;
      background: linear-gradient(90deg, #00ffea, #5b42f3, #ff3c83);
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: pulseText 3s infinite;
      margin-bottom: 20px;
    }

    .hidden { display: none; }

    #menu, #game, #gameOver {
      text-align: center;
    }

    button {
      font-size: 1rem;
      padding: 10px 25px;
      background: linear-gradient(135deg, #1f1f1f, #333);
      color: #fff;
      border: 2px solid #8562b3;
      cursor: pointer;
      border-radius: 30px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 10px rgba(255, 255, 255, 0.1);
    }

    button:hover {
      background: linear-gradient(135deg, rgb(172, 15, 91), #4516b4);
      transform: scale(1.05);
      border-color: rgb(0, 240, 240);
    }

    .exitBtn {
      background: linear-gradient(135deg, #C42B1C, #5a0e09);
      border: 2px solid #8562b3;
    }

    @keyframes pulseText {
      0% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.8; transform: scale(1.05); }
      100% { opacity: 1; transform: scale(1); }
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    :root {
      --app-height: 100vh; /* fallback */
    }

    #gameWrapper {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      height: 100dvh;
      width: 100vw;
      overflow: hidden;
      box-sizing: border-box;
      transform: scale(
        min(
          calc((100vw - 20px) / 360),
          calc((100vh - 40px) / 540)
        )
      );
      transform-origin: top center;
    }

    #gameScaleBox {
      width: 360px;
      height: 540px;
      padding: 8px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
    }
  </style>
</head>
<body>
  

  <!-- ‚úÖ Main Menu -->
  <div id="menu" class="overlay">
    <div style="height: 10vh;"></div>
    <h1 id="SnakeM">SNAKE GAME</h1>
    <div class="menuButtons">
      <button onclick="selectDifficulty()">Start Game</button>
      <button onclick="showInstruction()">Instructions</button>
      <button onclick="showAbout()">About</button> <!-- üëà New button -->
    </div>
  </div>

  <!-- ‚úÖ Game Screen -->
  <div id="game" class="hidden">
    <div id="gameWrapper">
      <div id="gameScaleBox"> <!-- ‚úÖ Add wrapper -->
        <canvas id="gameCanvas"></canvas>
        <div id="controls">
          <button onclick="pauseGame()">Pause</button>
          <button onclick="resumeGame()">Resume</button>
          <button class="exitBtn" onclick="if (!isPaused) pauseGame(); showMenu()">Exit</button>
        </div>
    
        <!-- ‚úÖ Mobile Controls -->
        <div id="mobileControls">
          <div class="mobileRow">
            <button class="mobileButtons" onclick="move('UP')">‚¨ÜÔ∏è</button>
          </div>
          <div class="mobileRow">
            <button class="mobileButtons" onclick="move('LEFT')">‚¨ÖÔ∏è</button>
            <button class="mobileButtons" onclick="move('DOWN')">‚¨áÔ∏è</button>
            <button class="mobileButtons" onclick="move('RIGHT')">‚û°Ô∏è</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚úÖ Game Over Screen -->
  <div id="gameOver" class="hidden">
    <div style="height: 5vh;"></div>
  <div id="OverHeader">!! Game Over !!</div>
    <h2 id="gameOverText"></h2>
    <div class="overButtons">
      <button onclick="startGame()">Restart</button>
      <button onclick="showMenu()">Cancel</button>
      <button class="exitBtn" onclick="showMenu()">Exit</button>
    </div>
  </div>

  <!-- üîä Sound Effects -->
  <audio id="eatSound" src="https://www.soundjay.com/human/bone-crack-1.mp3"></audio>
  <audio id="gameOverSound" src="https://www.soundjay.com/buttons/button-4.mp3"></audio>
  <audio id="startSound" src="https://www.soundjay.com/buttons/button-11.mp3"></audio>

  <script>
    const gameDiv = document.getElementById('game');
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    // ‚úÖ Fixed canvas size (ideal layout for your game)
    canvas.width = 360;
    canvas.height = 480;

    const tileSize = 15;
    let cols = Math.floor(canvas.width / tileSize);
    let rows = Math.floor(canvas.height / tileSize);


    let x, y, dx, dy, score, nTail, tail, fruit, fruitNo = 5, obstacles, gameOver = false, dir = '', gameNo = 0, isPaused = false;

    let speed = 100, difficulty = ' Easy ', highScore = 0, gameInterval, gameRunning = false, obstacleCount = 20;

    const eatSound = document.getElementById('eatSound');
    const gameOverSound = document.getElementById('gameOverSound');
    const startSound = document.getElementById('startSound');


    function isOccupied(x, y, snakeHead, tail, fruits,  obstacles) {
      if (y <= 1) return true;  // It will prevent fruits and obstacles from being generated on the score text area

      if (x === snakeHead.x && y === snakeHead.y) return true;

      for (let part of tail) {
        if (part.x === x && part.y === y) return true;
      }

      for (let f of fruits) {
        if (f.x === x && f.y === y) return true;
      }

      for (let obs of obstacles) {
        if (obs.x === x && obs.y === y) return true;
      }

      return false;
    }

    function getValidPosition(snakeHead, tail, fruits, obstacles, cols, rows) {
      let x, y;
      let attempts = 0;
      do {
        x = Math.floor(Math.random() * cols);
        y = Math.floor(Math.random() * rows);
        attempts++;
        if (attempts > 1000) break; // prevent infinite loop
      } while (isOccupied(x, y, snakeHead, tail, fruits, obstacles));
      return { x, y };
    }

    function initGame() {
      x = Math.floor(cols / 2);
      y = Math.floor(rows / 2);
      dx = dy = 0;
      score = 0;
      nTail = 0;
      dir = '';
      tail = [];
      fruit = [];
      obstacles = [];

      let snakeHead = { x, y };

      // Generate 3 non-overlapping fruits
      for (let i = 0; i < fruitNo; i++) {
        let pos = getValidPosition(snakeHead, tail, fruit, obstacles, cols, rows);
        fruit.push(pos);
      }

      // Generate non-overlapping obstacles
      for (let i = 0; i < (obstacleCount || 5); i++) {
        let pos = getValidPosition(snakeHead, tail, fruit, obstacles, cols, rows);
        obstacles.push(pos);
      }

      gameOver = false;
    }

    function showMenu() {
      document.getElementById("menu").style.display = "flex"; // üëà restore buttons
      gameDiv.classList.add("hidden");
      document.getElementById("gameOver").classList.add("hidden");
      clearInterval(gameInterval);
      gameRunning = false;
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      ctx.save();
      ctx.font = "20px monospace";
      ctx.fillStyle = "white";
      ctx.textAlign = "left";
      ctx.fillText(`Score: ${score}`, 10, 20);

      ctx.textAlign = "right";
      ctx.fillText(`High Score: ${highScore}`, canvas.width - 10, 20);
      ctx.textAlign = "left"; // reset alignment
      ctx.restore(); // Restores all previous canvas state


      ctx.fillStyle = "lime";
      ctx.fillRect(x * tileSize, y * tileSize, tileSize, tileSize);

      ctx.fillStyle = "green";
      for (let i = 0; i < tail.length; i++) {
        ctx.fillRect(tail[i].x * tileSize, tail[i].y * tileSize, tileSize, tileSize);
      }

      ctx.font = `${tileSize + 1}px Arial`; // Adjust font size as needed
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";

      fruit.forEach(f => {
        ctx.fillText("üçé", f.x * tileSize + tileSize / 2, f.y * tileSize + tileSize / 2);
      });


      ctx.fillStyle = "gray";
      obstacles.forEach(o => {
        ctx.fillRect(o.x * tileSize, o.y * tileSize, tileSize, tileSize);
      });
    }

    function update() {
      if (gameOver || isPaused) return;

      tail.unshift({ x, y });
      if (tail.length > nTail) tail.pop();

      switch (dir) {
        case 'LEFT': x--; break;
        case 'RIGHT': x++; break;
        case 'UP': y--; break;
        case 'DOWN': y++; break;
      }

      if (
        x < 0 || x >= cols || y < 0 || y >= rows ||
        tail.some(t => t.x === x && t.y === y) ||
        obstacles.some(o => o.x === x && o.y === y)
      ) {
        gameOver = true;
      }

      for (let i = 0; i < fruit.length; i++) {
        if (fruit[i].x === x && fruit[i].y === y) {
          score += 10;
          nTail++;
          
          const eatClone = eatSound.cloneNode();
          eatClone.play();

          fruit[i] = getValidPosition({x, y}, tail, fruit, obstacles, cols, rows);
        }
      }

      if (gameOver) endGame();
    }

    function endGame() {
      clearInterval(gameInterval);
      gameRunning = false;
      gameOverSound.play();

      if (score > highScore) {
        highScore = score;
        localStorage.setItem('snakeHighScore', highScore);
      }
      
      gameDiv.classList.add("hidden");
      document.getElementById("gameOver").classList.remove("hidden");
      document.getElementById("gameOverText").textContent = `Score: ${score}\nHigh Score: ${highScore}`;
    }

    function gameLoop() {
      update();
      draw();
    }

    function startGame() {
      startSound.play();
      initGame();
      gameNo++;
      isPaused = false;
      gameRunning = true;

      document.getElementById("menu").style.display = "none";
      document.getElementById("gameOver").classList.add("hidden");
      gameDiv.classList.remove("hidden");
      
      gameInterval = setInterval(gameLoop, speed);
    }

    function pauseGame() { isPaused = true; }
    function resumeGame() { if (gameRunning) isPaused = false; }

    function restartGame() {
      startGame();
    }

    function selectDifficulty() {
      // Show the difficulty selection modal
      document.getElementById("difficultyModal").style.display = "flex";
    }

    function setDifficulty(choice) {
      if (choice === 'e') {
        speed = 175; difficulty = "Easy"; obstacleCount = 20;
        canvas.style.borderColor = "#87CEEB"
      } else if (choice === 'm') {
        speed = 150; difficulty = "Medium"; obstacleCount = 35;
        canvas.style.borderColor = "#6495ED"
      } else if (choice === 'h') {
        speed = 125; difficulty = "Hard"; obstacleCount = 50;
        canvas.style.borderColor = "#4682B4"
      }
      document.getElementById("difficultyModal").style.display = "none";
      startGame();
    }

    function showInstruction() {
      document.getElementById("instructionModal").style.display = "flex";
    }

    function closeInstructions() {
      document.getElementById("instructionModal").style.display = "none";
    }

    function showAbout() {
      document.getElementById("aboutModal").style.display = "flex";
    }

    function closeAbout() {
      document.getElementById("aboutModal").style.display = "none";
    }

    function move(newDir) {
      if (!gameRunning) return; // game not started yet

      // Only allow first direction to start game
      if (!dir) {
        dir = newDir;
      } else {
        // Prevent reverse movement
        if (
          (newDir === 'UP' && dir !== 'DOWN') ||
          (newDir === 'DOWN' && dir !== 'UP') ||
          (newDir === 'LEFT' && dir !== 'RIGHT') ||
          (newDir === 'RIGHT' && dir !== 'LEFT')
        ) {
          dir = newDir;
        }
      }
    }

    // ‚úÖ Keyboard Controls
    window.addEventListener("keydown", e => {
      const key = e.code;

      const startIfNeeded = (newDir, blockDir) => {
        if (!dir && gameRunning) {
          dir = newDir;
        } else if (dir !== blockDir) {
          dir = newDir;
        }
      };

      if (key === "ArrowUp") startIfNeeded("UP", "DOWN");
      else if (key === "ArrowDown") startIfNeeded("DOWN", "UP");
      else if (key === "ArrowLeft") startIfNeeded("LEFT", "RIGHT");
      else if (key === "ArrowRight") startIfNeeded("RIGHT", "LEFT");
      else if (key === "KeyP") isPaused = !isPaused;
      else if (key === "KeyR" && gameOver) startGame();
      else if (key === "KeyQ" && gameOver) showMenu();
    });

    // ‚úÖ Load high score
    highScore = parseInt(localStorage.getItem('snakeHighScore')) || 0;


    function resizeGame() {
      const wrapper = document.getElementById('gameWrapper');
      const scaleBox = document.getElementById('gameScaleBox');
      
      const vw = window.innerWidth;
      const vh = window.innerHeight;

      const desiredWidth = 360;
      const desiredHeight = 540;

      // Padding around the scale box (can be adjusted)
      const paddingX = 40;  // horizontal padding
      const paddingY = 80;  // vertical padding (also makes room for controls)

      const scale = Math.min(
        (vw - paddingX) / desiredWidth,
        (vh - paddingY) / desiredHeight
      );

      wrapper.style.transform = `scale(${scale})`;
      wrapper.style.transformOrigin = 'top center';

      // Optional: add padding to the scale box for visibility
      scaleBox.style.padding = '10px'; // can tweak as needed

    }

   // ‚úÖ Call resizeGame on page load and when resizing the window
    window.addEventListener("resize", resizeGame);
    window.addEventListener("load", resizeGame);

    // Detect if it's a touch device (mobile/tablet)
    function isMobileDevice() {
      const ua = navigator.userAgent || navigator.vendor || window.opera;

      // Check common mobile device indicators in user agent
      const isTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;

      const isMobileAgent = /android|iphone|ipad|ipod|opera mini|iemobile|mobile/i.test(ua);

      return isTouch || isMobileAgent;
    }


    // Show mobile controls only on mobile
    window.addEventListener('DOMContentLoaded', () => {
      const mobileControls = document.getElementById('mobileControls');
      if (isMobileDevice()) {
        mobileControls.style.display = 'flex';
      } else {
        mobileControls.style.display = 'none';
      }
    });

    function setAppHeight() {
      const appHeight = window.innerHeight;
      document.documentElement.style.setProperty('--app-height', `${appHeight}px`);
      resizeGame(); // ensure game scales correctly after height update
    }

    window.addEventListener('resize', setAppHeight);
    window.addEventListener('load', setAppHeight);
  </script>

  <div id="difficultyModal" style="position:fixed; top: 0; left:0; width:100vw; height:100vh; background:#000000cc; color:white; display:none; align-items:center; justify-content:center; flex-direction:column; z-index:1000;">
    <h2 id="difficulty">Select Difficulty</h2>
    <div>
      <button onclick="setDifficulty('e')">Easy</button>
      <button onclick="setDifficulty('m')">Medium</button>
      <button onclick="setDifficulty('h')">Hard</button>
    </div>
  </div>

  <div id="instructionModal" class="modal">
    <div class="modal-content">
      <h2 class="About">Instructions</h2>
      <p>
        üêç 1. The snake (üü©) starts at the center.<br>
        ‚¨ÜÔ∏è 2. Use the arrow keys to move the snake.<br>
        üçé 3. Eat the fruits (üü•) to grow longer and score points.<br>
        ‚ö†Ô∏è 4. Avoid hitting walls, yourself (üü©), or obstacles (‚¨õ).<br>
        ‚è∏Ô∏è 5. Press [P] or tap the 'Pause' button to pause the game.<br>
        ‚ñ∂Ô∏è 6. Press [P] again or tap the 'Resume' button to continue.<br>

      </p>
      <button onclick="closeInstructions()">Close</button>
    </div>
  </div>

  <div id="aboutModal" class="modal">
    <div class="modal-content">
      <h2 class="About">About This Game</h2>
      <p>
        üéÆ Welcome to the Classic Snake Game ‚Äî Remade with a Modern Touch!<br>
        üöÄ The snake (üü©) starts at the center of the arena.<br>
        üêç Eat the fruits (üü•) to grow longer and increase your score.<br>
        ‚ö†Ô∏è Avoid crashing into walls, yourself, or obstacles (‚¨õ).<br><br>
        üë®‚Äçüíª Developed with ‚ù§Ô∏è by <strong>Subhajit</strong><br>
        <code><strong>Made in India üáÆüá≥</strong></code>
      </p>
      <button onclick="closeAbout()">Close</button>
    </div>
  </div>

</body>
</html>
